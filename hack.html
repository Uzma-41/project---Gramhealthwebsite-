<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GramHealth | Rural Healthcare Assistant</title>

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="style.css">

<style>
/* ================= GLOBAL ================= */
html {
    scroll-behavior: smooth;
}

body {
    margin: 0;
    font-family: 'Roboto', sans-serif;
    background: #f4f7f6;
    color: #333;
}

h1, h2 {
    margin-bottom: 10px;
}

p {
    line-height: 1.6;
}

.btn {
    padding: 12px 18px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
}

.btn-primary {
    background: #1e88e5;
    color: #fff;
}

.btn-secondary {
    background: #43a047;
    color: #fff;
}

section {
    padding: 50px 20px;
}

/* ================= HEADER ================= */
header {
    background: #ffffff;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.logo {
    font-size: 22px;
    font-weight: bold;
}

.badge {
    background: #4caf50;
    color: #fff;
    padding: 4px 8px;
    border-radius: 6px;
    font-size: 12px;
    margin-left: 8px;
}

nav a {
    margin-right: 15px;
    text-decoration: none;
    color: #333;
    font-weight: 500;
}

.external-link {
    display: inline-block;
    background: #1e88e5;
    color: #fff;
    padding: 8px 16px;
    border-radius: 6px;
    text-decoration: none;
    font-weight: 500;
    font-size: 14px;
    transition: background 0.3s;
}

.external-link:hover {
    background: #1565c0;
}

/* ================= HERO ================= */
.hero {
    background: linear-gradient(135deg, #1e88e5, #43a047);
    color: #fff;
    text-align: center;
    padding: 70px 20px;
}

.hero-icons {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin-top: 25px;
    flex-wrap: wrap;
}

.hero-icons div {
    font-size: 18px;
}

/* ================= CARD SECTIONS ================= */
.card-section {
    max-width: 1100px;
    margin: auto;
}

.cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-top: 25px;
}

.card {
    background: #fff;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    text-align: center;
    cursor: pointer;
}

.card i {
    font-size: 30px;
    margin-bottom: 10px;
    color: #1e88e5;
}

/* ================= CHATBOT ================= */
.modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
}

.modal-content {
    background: #fff;
    max-width: 400px;
    margin: 60px auto;
    border-radius: 12px;
    padding: 20px;
    display: flex;
    flex-direction: column;
    height: 500px;
}

.close {
    text-align: right;
    font-size: 22px;
    cursor: pointer;
}

#chat {
    flex: 1;
    overflow-y: auto;
    margin: 10px 0;
}

.msg {
    margin-bottom: 10px;
    padding: 8px 12px;
    border-radius: 8px;
    max-width: 80%;
}

.bot {
    background: #e3f2fd;
}

.user {
    background: #c8e6c9;
    align-self: flex-end;
}

.input-area {
    display: flex;
    gap: 10px;
}

input {
    flex: 1;
    padding: 10px;
}

/* ================= FOOTER ================= */
footer {
    background: #1a1a1a;
    color: #fff;
    padding: 40px 20px 20px;
    font-size: 14px;
    margin-top: 60px;
}

.footer-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 30px;
    max-width: 1200px;
    margin: 0 auto 30px;
}

.footer-section h4 {
    margin-top: 0;
    color: #1e88e5;
    font-size: 16px;
}

.footer-section p {
    margin: 8px 0;
    color: #ccc;
    line-height: 1.5;
}

.footer-section ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.footer-section ul li {
    margin: 8px 0;
}

.footer-section ul li a {
    color: #ccc;
    text-decoration: none;
    transition: color 0.3s;
}

.footer-section ul li a:hover {
    color: #1e88e5;
}

.social-links {
    display: flex;
    gap: 15px;
}

.social-links a {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: #1e88e5;
    color: #fff;
    border-radius: 50%;
    text-decoration: none;
    transition: background 0.3s;
    font-size: 18px;
}

.social-links a:hover {
    background: #1565c0;
}

.footer-bottom {
    border-top: 1px solid #333;
    padding-top: 20px;
    text-align: center;
    color: #aaa;
}

.footer-bottom p {
    margin: 8px 0;
}
</style>
</head>

<body>

<!-- Voice Chat Assistant Button -->
<button id="voice-chat-btn" class="voice-chat-button" title="Open Voice Chat Assistant">
    <i class="fas fa-microphone"></i>
</button>

<!-- Voice Chat Assistant Modal -->
<div id="voice-chat-modal" class="voice-modal">
    <div class="voice-modal-content">
        <span class="close-voice">&times;</span>
        <div class="voice-header">
            <div class="audio-icon-container">
                <i class="fas fa-ear" id="ear-icon"></i>
            </div>
            <h2>Virtual Health Assistant</h2>
            <p class="subtitle">Not a replacement for doctors</p>
        </div>
        
        <div class="voice-chat-area">
            <div id="voice-messages" class="voice-messages">
                <div class="voice-message bot greeting-message">
                    <strong>üëã Hello!</strong> Tell me your health problem.
                </div>
            </div>
        </div>
        
        <div id="audio-waves" class="audio-waves" style="display:none;">
            <div class="wave"></div>
            <div class="wave"></div>
            <div class="wave"></div>
            <div class="wave"></div>
            <div class="wave"></div>
        </div>
        
        <div class="voice-input-area">
            <input type="text" id="voice-text-input" class="voice-input" placeholder="Or type your problem...">
            <button id="send-voice-text" class="send-btn">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
        
        <div class="voice-controls">
            <button id="start-listening" class="voice-btn listening-btn">
                <i class="fas fa-microphone"></i> Start Listening
            </button>
            <button id="stop-listening" class="voice-btn stop-btn" style="display:none;">
                <i class="fas fa-stop-circle"></i> Stop
            </button>
            <button id="toggle-voice-output" class="voice-btn">
                <i class="fas fa-volume-up"></i> Voice ON
            </button>
        </div>
        
        <div class="voice-info">
            <p id="status-text">Ready to listen... üé§</p>
        </div>
    </div>
</div>

<!-- ================= HEADER ================= -->
<header>
    <div class="logo">ü©∫ GramHealth <span class="badge">Verified</span></div>
    <nav>
        <a href="#home">Home</a>
        <a href="#services">Services</a>
        <a href="#doctor">Doctors</a>
        <a href="https://healthsaathi.zapier.app" target="_blank" class="external-link">HealthSaathi</a>
    </nav>
</header>

<!-- ================= HERO ================= -->
<section class="hero" id="home">
    <h1>Basic Health Help, Anytime, Anywhere</h1>
    <p>Designed for rural communities with limited access to doctors.</p>

    <div class="hero-icons">
        <div>üßë‚Äç‚öïÔ∏è Verified Advice</div>
        <div>üìû Virtual Consultation</div>
        <div>üì± Works on Low Internet</div>
    </div>
</section>

<!-- ================= SERVICES ================= -->
<section class="card-section" id="services">
    <h2>Check Common Health Problems</h2>
    <p>Select your issue to get safe health guidance.</p>

    <div class="cards">
        <div class="card" onclick="startChat('fever')">
            <i class="fas fa-thermometer-half"></i>
            <h3>Fever</h3>
        </div>
        <div class="card" onclick="startChat('headache')">
            <i class="fas fa-head-side-virus"></i>
            <h3>Headache</h3>
        </div>
        <div class="card" onclick="startChat('cold')">
            <i class="fas fa-virus"></i>
            <h3>Cold & Cough</h3>
        </div>
        <div class="card" onclick="startChat('skin')">
            <i class="fas fa-allergies"></i>
            <h3>Skin Problem</h3>
        </div>
    </div>
</section>

<!-- ================= DISEASE PHOTO ANALYSIS ================= -->
<section class="card-section" id="photo-analysis">
    <h2>üè• Disease Photo Analysis & AI Consultation</h2>
    <p>Upload a disease photo for AI analysis. Doctors learn from your photos to provide better recommendations.</p>
    
    <div class="analysis-container">
        <div class="upload-options">
            <button id="camera-btn" class="btn btn-secondary"><i class="fas fa-camera"></i> Open Camera</button>
            <label for="file-upload" class="btn btn-secondary" style="cursor:pointer; display:inline-block; margin:0 0.5rem; text-decoration:none;">
                <i class="fas fa-image"></i> Upload Photo
            </label>
            <input type="file" id="file-upload" accept="image/*" style="display:none;">
        </div>
        
        <video id="video" style="display:none; width:100%; max-width:400px; border-radius:10px; margin:1rem 0;"></video>
        <canvas id="canvas" style="display:none;"></canvas>
        <button id="capture-btn" class="btn btn-primary" style="display:none; margin:1rem 0;">
            <i class="fas fa-camera"></i> Capture & Analyze
        </button>
        
        <div id="analysis-result" class="analysis-result-box"></div>
        
        <div id="ai-response-section" style="display:none;" class="ai-response-section">
            <h3>ü§ñ AI Analysis & Doctor Recommendations</h3>
            <div id="ai-response" class="ai-response-box"></div>
            <button onclick="openBot()" class="btn btn-primary" style="margin-top:1rem;">
                <i class="fas fa-comments"></i> Chat with AI Doctor
            </button>
        </div>
    </div>
</section>

<!-- ================= LIVE DOCTOR CONSULTATION SECTION ================= -->
<section class="card-section" id="live-consultation">
    <h2>üè• Live Doctor Consultation</h2>
    <p>Connect with verified doctors via video or audio call. Get instant medical advice from specialists.</p>
    
    <div class="consultation-options">
        <div class="option-card video-option">
            <i class="fas fa-video"></i>
            <h3>Video Call</h3>
            <p>Face-to-face consultation with doctor</p>
            <p class="time">Average: 15-30 mins</p>
        </div>
        <div class="option-card audio-option">
            <i class="fas fa-phone-alt"></i>
            <h3>Audio Call</h3>
            <p>Voice consultation with specialist</p>
            <p class="time">Average: 10-20 mins</p>
        </div>
    </div>

    <h3 style="margin-top:2rem; margin-bottom:1rem; text-align:center;">üë®‚Äç‚öïÔ∏è Available Doctors</h3>
    
    <div class="doctors-list-section">
        <div class="doctor-list-card">
            <div class="doctor-info">
                <div class="doctor-avatar-circle">üë®‚Äç‚öïÔ∏è</div>
                <div class="doctor-details">
                    <h4>Dr. Rajesh Kumar</h4>
                    <p class="specialty">General Physician</p>
                    <p class="qualifications">MBBS, MD (Internal Medicine)</p>
                    <p class="rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (247 reviews) | 5+ years experience</p>
                    <p class="status-info">üü¢ Available Now - Response in 2 mins</p>
                </div>
            </div>
            <div class="doctor-actions">
                <button class="btn btn-secondary" onclick="initiateCall('Dr. Rajesh Kumar', 'video')">
                    <i class="fas fa-video"></i> Video Call
                </button>
                <button class="btn btn-primary" onclick="initiateCall('Dr. Rajesh Kumar', 'audio')">
                    <i class="fas fa-phone-alt"></i> Audio Call
                </button>
            </div>
        </div>

        <div class="doctor-list-card">
            <div class="doctor-info">
                <div class="doctor-avatar-circle">üë©‚Äç‚öïÔ∏è</div>
                <div class="doctor-details">
                    <h4>Dr. Priya Singh</h4>
                    <p class="specialty">Dermatologist</p>
                    <p class="qualifications">MBBS, MD (Dermatology)</p>
                    <p class="rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (189 reviews) | 7+ years experience</p>
                    <p class="status-info">üü¢ Available Now - Response in 1 min</p>
                </div>
            </div>
            <div class="doctor-actions">
                <button class="btn btn-secondary" onclick="initiateCall('Dr. Priya Singh', 'video')">
                    <i class="fas fa-video"></i> Video Call
                </button>
                <button class="btn btn-primary" onclick="initiateCall('Dr. Priya Singh', 'audio')">
                    <i class="fas fa-phone-alt"></i> Audio Call
                </button>
            </div>
        </div>

        <div class="doctor-list-card">
            <div class="doctor-info">
                <div class="doctor-avatar-circle">üë®‚Äç‚öïÔ∏è</div>
                <div class="doctor-details">
                    <h4>Dr. Amrish Patel</h4>
                    <p class="specialty">ENT Specialist</p>
                    <p class="qualifications">MBBS, DNB (ENT)</p>
                    <p class="rating">‚≠ê‚≠ê‚≠ê‚≠ê (156 reviews) | 6+ years experience</p>
                    <p class="status-info">üü¢ Available Now - Response in 3 mins</p>
                </div>
            </div>
            <div class="doctor-actions">
                <button class="btn btn-secondary" onclick="initiateCall('Dr. Amrish Patel', 'video')">
                    <i class="fas fa-video"></i> Video Call
                </button>
                <button class="btn btn-primary" onclick="initiateCall('Dr. Amrish Patel', 'audio')">
                    <i class="fas fa-phone-alt"></i> Audio Call
                </button>
            </div>
        </div>

        <div class="doctor-list-card">
            <div class="doctor-info">
                <div class="doctor-avatar-circle">üë©‚Äç‚öïÔ∏è</div>
                <div class="doctor-details">
                    <h4>Dr. Neha Sharma</h4>
                    <p class="specialty">Pediatrician</p>
                    <p class="qualifications">MBBS, MD (Pediatrics)</p>
                    <p class="rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (312 reviews) | 8+ years experience</p>
                    <p class="status-info">üü¢ Available Now - Response in 2 mins</p>
                </div>
            </div>
            <div class="doctor-actions">
                <button class="btn btn-secondary" onclick="initiateCall('Dr. Neha Sharma', 'video')">
                    <i class="fas fa-video"></i> Video Call
                </button>
                <button class="btn btn-primary" onclick="initiateCall('Dr. Neha Sharma', 'audio')">
                    <i class="fas fa-phone-alt"></i> Audio Call
                </button>
            </div>
        </div>

        <div class="doctor-list-card">
            <div class="doctor-info">
                <div class="doctor-avatar-circle">üë®‚Äç‚öïÔ∏è</div>
                <div class="doctor-details">
                    <h4>Dr. Vikram Singh</h4>
                    <p class="specialty">Cardiologist</p>
                    <p class="qualifications">MBBS, MD (Cardiology)</p>
                    <p class="rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (198 reviews) | 10+ years experience</p>
                    <p class="status-info">üü¢ Available Now - Response in 4 mins</p>
                </div>
            </div>
            <div class="doctor-actions">
                <button class="btn btn-secondary" onclick="initiateCall('Dr. Vikram Singh', 'video')">
                    <i class="fas fa-video"></i> Video Call
                </button>
                <button class="btn btn-primary" onclick="initiateCall('Dr. Vikram Singh', 'audio')">
                    <i class="fas fa-phone-alt"></i> Audio Call
                </button>
            </div>
        </div>

        <div class="doctor-list-card">
            <div class="doctor-info">
                <div class="doctor-avatar-circle">üë©‚Äç‚öïÔ∏è</div>
                <div class="doctor-details">
                    <h4>Dr. Ananya Gupta</h4>
                    <p class="specialty">Gynecologist</p>
                    <p class="qualifications">MBBS, MD (Obstetrics & Gynecology)</p>
                    <p class="rating">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (276 reviews) | 9+ years experience</p>
                    <p class="status-info">üü¢ Available Now - Response in 2 mins</p>
                </div>
            </div>
            <div class="doctor-actions">
                <button class="btn btn-secondary" onclick="initiateCall('Dr. Ananya Gupta', 'video')">
                    <i class="fas fa-video"></i> Video Call
                </button>
                <button class="btn btn-primary" onclick="initiateCall('Dr. Ananya Gupta', 'audio')">
                    <i class="fas fa-phone-alt"></i> Audio Call
                </button>
            </div>
        </div>
    </div>
</section>

<!-- ================= VIDEO CALL MODAL ================= -->
<div id="videoCallModal" class="modal">
    <div class="video-call-container">
        <div class="video-call-header">
            <h3>Video Consultation with <span id="doctorNameDisplay"></span></h3>
            <span class="close" onclick="endVideoCall()">&times;</span>
        </div>

        <div class="video-call-content">
            <div class="video-streams">
                <div class="video-box patient-video">
                    <div class="video-placeholder">
                        <i class="fas fa-camera"></i>
                        <p>Your Camera</p>
                    </div>
                    <p class="label">You</p>
                </div>

                <div class="video-box doctor-video">
                    <div class="video-placeholder doctor-video-placeholder">
                        <div class="doctor-avatar-large">üë®‚Äç‚öïÔ∏è</div>
                        <p id="doctorVideoName"></p>
                    </div>
                    <p class="label">Doctor</p>
                </div>
            </div>

            <div class="call-info">
                <p id="callTimer">00:00</p>
                <p id="callStatus">Connected ‚úì</p>
            </div>

            <div class="chat-section">
                <h4>üí¨ Chat with Doctor</h4>
                <div id="videoCallChat" class="video-call-chat"></div>
                <div class="chat-input-area">
                    <input type="text" id="videoChatInput" placeholder="Ask your question...">
                    <button onclick="sendVideoCallMessage()" class="btn btn-secondary" style="padding: 8px 16px;">
                        <i class="fas fa-paper-plane"></i> Send
                    </button>
                </div>
            </div>
        </div>

        <div class="video-controls">
            <button class="control-btn" id="toggleMic" onclick="toggleMic()" title="Toggle Microphone">
                <i class="fas fa-microphone"></i>
            </button>
            <button class="control-btn" id="toggleCamera" onclick="toggleCamera()" title="Toggle Camera">
                <i class="fas fa-video"></i>
            </button>
            <button class="control-btn" id="toggleScreen" onclick="shareScreen()" title="Share Screen">
                <i class="fas fa-share-square"></i>
            </button>
            <button class="control-btn end-call" onclick="endVideoCall()" title="End Call">
                <i class="fas fa-phone-slash"></i> End Call
            </button>
        </div>
    </div>
</div>

<!-- ================= CHATBOT ================= -->
<div class="modal" id="botModal">
    <div class="modal-content">
        <span class="close" onclick="closeBot()">&times;</span>
        <h3>Virtual Health Assistant</h3>
        <p style="font-size:13px;color:#666">Not a replacement for doctors</p>

        <div id="chat"></div>

        <div class="input-area">
            <input type="text" id="userInput" placeholder="Type your problem...">
            <button class="btn btn-secondary" onclick="sendMsg()">Send</button>
        </div>
    </div>
</div>

<!-- ================= FOOTER ================= -->
<footer>
    <div class="footer-container">
        <div class="footer-section">
            <h4>About GramHealth</h4>
            <p>Providing accessible healthcare guidance to rural communities with limited doctor access.</p>
        </div>
        
        <div class="footer-section">
            <h4>Quick Links</h4>
            <ul>
                <li><a href="#home">Home</a></li>
                <li><a href="#services">Services</a></li>
                <li><a href="#doctor">Doctors</a></li>
                <li><a href="https://healthsaathi.zapier.app" target="_blank">HealthSaathi</a></li>
            </ul>
        </div>
        
        <div class="footer-section">
            <h4>Contact Us</h4>
            <p>üìß Email: support@gramhealth.com</p>
            <p>üìû Phone: +91-XXXX-XXXX-XX</p>
            <p>üìç Address: Rural Healthcare Initiative</p>
        </div>
        
        <div class="footer-section">
            <h4>Follow Us</h4>
            <div class="social-links">
                <a href="#" title="Facebook"><i class="fab fa-facebook"></i></a>
                <a href="#" title="Twitter"><i class="fab fa-twitter"></i></a>
                <a href="#" title="Instagram"><i class="fab fa-instagram"></i></a>
                <a href="#" title="LinkedIn"><i class="fab fa-linkedin"></i></a>
            </div>
        </div>
    </div>
    
    <div class="footer-bottom">
        <p>‚ö†Ô∏è <strong>Medical Disclaimer:</strong> This platform provides informational guidance only. Always consult a certified doctor for serious conditions.</p>
        <p>&copy; 2024 GramHealth. All rights reserved.</p>
    </div>
</footer>

<script>
const chat = document.getElementById("chat");

function openBot() {
    document.getElementById("botModal").style.display = "block";
    botMsg("Hello! Tell me your health problem.");
}

function closeBot() {
    document.getElementById("botModal").style.display = "none";
    chat.innerHTML = "";
}

function botMsg(text) {
    const div = document.createElement("div");
    div.className = "msg bot";
    div.innerText = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

function userMsg(text) {
    const div = document.createElement("div");
    div.className = "msg user";
    div.innerText = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

function startChat(issue) {
    openBot();
    setTimeout(() => handleIssue(issue), 400);
}

function handleIssue(issue) {
    if (issue === "fever") {
        botMsg("You selected Fever.");
        botMsg("Since how many days do you have fever?");
        botMsg("Do you also have cough or cold?");
        botMsg("If fever lasts more than 3 days, please consult a doctor.");
    } 
    else if (issue === "headache") {
        botMsg("You selected Headache.");
        botMsg("Is the pain mild or severe?");
        botMsg("Drink water and rest.");
        botMsg("If pain continues, consult a health worker.");
    } 
    else if (issue === "cold") {
        botMsg("Cold & Cough selected.");
        botMsg("Do you have sore throat or fever?");
        botMsg("Warm fluids and rest are helpful.");
    } 
    else if (issue === "skin") {
        botMsg("Skin problem selected.");
        botMsg("Is there itching or redness?");
        botMsg("Avoid scratching and keep area clean.");
        botMsg("If condition worsens, consult a doctor.");
    }
}

function sendMsg() {
    const input = document.getElementById("userInput");
    if (!input.value) return;
    userMsg(input.value);
    botMsg("Thanks for sharing. Please consult a doctor if symptoms are serious.");
    input.value = "";
}

// ================ VOICE CHAT FUNCTIONALITY ================
const voiceChatBtn = document.getElementById('voice-chat-btn');
const voiceChatModal = document.getElementById('voice-chat-modal');
const closeVoiceBtn = document.querySelector('.close-voice');
const startListeningBtn = document.getElementById('start-listening');
const stopListeningBtn = document.getElementById('stop-listening');
const voiceTextInput = document.getElementById('voice-text-input');
const sendVoiceTextBtn = document.getElementById('send-voice-text');
const voiceMessagesDiv = document.getElementById('voice-messages');
const audioWaves = document.getElementById('audio-waves');
const statusText = document.getElementById('status-text');
const toggleVoiceOutputBtn = document.getElementById('toggle-voice-output');

let mediaRecorder;
let audioChunks = [];
let isListening = false;
let voiceOutputEnabled = true;
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognition;

if (SpeechRecognition) {
    recognition = new SpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = true;
    recognition.lang = 'en-US';
}

// Open voice chat modal
voiceChatBtn.addEventListener('click', () => {
    voiceChatModal.style.display = 'block';
    statusText.textContent = 'üé§ Ready to listen...';
});

// Close voice chat modal
closeVoiceBtn.addEventListener('click', () => {
    voiceChatModal.style.display = 'none';
    if (isListening) {
        stopListening();
    }
});

// Start listening to user
startListeningBtn.addEventListener('click', () => {
    if (!recognition) {
        alert('Speech recognition not supported in your browser. Please use Chrome, Edge, or Safari.');
        return;
    }
    
    isListening = true;
    audioChunks = [];
    startListeningBtn.style.display = 'none';
    stopListeningBtn.style.display = 'inline-block';
    audioWaves.style.display = 'flex';
    statusText.textContent = 'üé§ Listening... Speak now!';
    voiceChatBtn.classList.add('listening');
    
    recognition.start();
});

// Stop listening
function stopListening() {
    if (recognition) {
        recognition.stop();
    }
    isListening = false;
    startListeningBtn.style.display = 'inline-block';
    stopListeningBtn.style.display = 'none';
    audioWaves.style.display = 'none';
    statusText.textContent = '‚úì Recording ended';
    voiceChatBtn.classList.remove('listening');
}

stopListeningBtn.addEventListener('click', stopListening);

// Handle speech recognition results
if (recognition) {
    recognition.onstart = () => {
        statusText.textContent = 'üé§ Listening...';
    };
    
    recognition.onresult = (event) => {
        let transcript = '';
        for (let i = event.resultIndex; i < event.results.length; i++) {
            transcript += event.results[i][0].transcript;
        }
        voiceTextInput.value = transcript;
        statusText.textContent = '‚úì Heard: ' + transcript;
    };
    
    recognition.onerror = (event) => {
        statusText.textContent = '‚ùå Error: ' + event.error;
    };
    
    recognition.onend = () => {
        if (isListening) {
            statusText.textContent = '‚úì Processing...';
        }
    };
}

// Send voice message
function sendVoiceMessage() {
    const message = voiceTextInput.value.trim();
    if (!message) return;
    
    // Add user message
    const userMsgDiv = document.createElement('div');
    userMsgDiv.className = 'voice-message user';
    userMsgDiv.innerHTML = `<strong>You:</strong> ${message}`;
    voiceMessagesDiv.appendChild(userMsgDiv);
    voiceMessagesDiv.scrollTop = voiceMessagesDiv.scrollHeight;
    
    voiceTextInput.value = '';
    statusText.textContent = '‚è≥ Doctor responding...';
    
    // Simulate doctor response
    setTimeout(() => {
        const doctorResponses = [
            'I understand your concern. Based on your symptoms, I recommend rest and hydration.',
            'That sounds like a common condition. Please monitor your symptoms closely.',
            'I suggest you take the prescribed medication and follow up in a few days.',
            'Your symptoms suggest you should consult a specialist. Would you like a referral?',
            'This may need further investigation. Please visit a clinic for proper examination.',
            'The treatment I recommend should help. Take it regularly as prescribed.',
            'If symptoms persist beyond 3 days, please seek immediate medical attention.',
            'Based on what you described, here is my advice and recommended treatment plan.'
        ];
        
        const response = doctorResponses[Math.floor(Math.random() * doctorResponses.length)];
        
        const botMsgDiv = document.createElement('div');
        botMsgDiv.className = 'voice-message bot';
        botMsgDiv.innerHTML = `<strong>üë®‚Äç‚öïÔ∏è Doctor:</strong> ${response}`;
        voiceMessagesDiv.appendChild(botMsgDiv);
        voiceMessagesDiv.scrollTop = voiceMessagesDiv.scrollHeight;
        
        statusText.textContent = '‚úì Response received';
        
        // Text-to-speech if enabled
        if (voiceOutputEnabled && 'speechSynthesis' in window) {
            const utterance = new SpeechSynthesisUtterance(response);
            utterance.rate = 1;
            utterance.pitch = 1;
            speechSynthesis.speak(utterance);
        }
    }, 1500);
}

sendVoiceTextBtn.addEventListener('click', sendVoiceMessage);
voiceTextInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') sendVoiceMessage();
});

// Toggle voice output
toggleVoiceOutputBtn.addEventListener('click', () => {
    voiceOutputEnabled = !voiceOutputEnabled;
    if (voiceOutputEnabled) {
        toggleVoiceOutputBtn.innerHTML = '<i class="fas fa-volume-up"></i> Voice ON';
        toggleVoiceOutputBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        statusText.textContent = 'üîä Voice output enabled';
    } else {
        toggleVoiceOutputBtn.innerHTML = '<i class="fas fa-volume-mute"></i> Voice OFF';
        toggleVoiceOutputBtn.style.background = '#f5576c';
        statusText.textContent = 'üîá Voice output disabled';
    }
});

// Close modal when clicking outside
window.addEventListener('click', (e) => {
    if (e.target === voiceChatModal) {
        voiceChatModal.style.display = 'none';
        if (isListening) {
            stopListening();
        }
    }
});

const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const captureBtn = document.getElementById('capture-btn');
const cameraBtn = document.getElementById('camera-btn');
const fileUpload = document.getElementById('file-upload');
const resultDiv = document.getElementById('analysis-result');
const aiResponseSection = document.getElementById('ai-response-section');
const aiResponseDiv = document.getElementById('ai-response');

let uploadedImageData = null;

// AI Disease Database with detailed responses
const diseaseDatabase = {
    acne: {
        name: "Acne/Pimples",
        confidence: 85,
        description: "Bacterial infection causing inflamed skin with pustules",
        medicines: [
            "Benzoyl Peroxide 5% cream - Apply twice daily",
            "Salicylic Acid 2% serum - Morning application",
            "Azithromycin - Prescribed by doctor"
        ],
        treatment: [
            "Keep face clean and dry",
            "Avoid touching or squeezing pimples",
            "Use non-comedogenic moisturizer",
            "Apply sunscreen daily"
        ],
        duration: "4-8 weeks for improvement",
        doctor: "Dermatologist",
        warning: "‚ö†Ô∏è If severe or widespread, consult dermatologist immediately"
    },
    eczema: {
        name: "Eczema/Dermatitis",
        confidence: 78,
        description: "Chronic inflammatory skin condition causing itching and rashes",
        medicines: [
            "Hydrocortisone 1% cream - Apply 2-3 times daily",
            "Cetaphil moisturizer - Use generously",
            "Antihistamine if itching severe"
        ],
        treatment: [
            "Use lukewarm water for bathing",
            "Apply moisturizer immediately after bathing",
            "Avoid harsh soaps and chemicals",
            "Wear soft, breathable clothing",
            "Avoid known triggers (allergens)"
        ],
        duration: "Chronic - Ongoing management needed",
        doctor: "Dermatologist",
        warning: "‚ö†Ô∏è If spreading or becoming infected, seek medical care"
    },
    fungal: {
        name: "Fungal Infection",
        confidence: 82,
        description: "Skin infection caused by fungi (ringworm, candida, etc.)",
        medicines: [
            "Clotrimazole 1% cream - Apply twice daily for 2-4 weeks",
            "Miconazole 2% cream - Alternative option",
            "Oral Fluconazole - If severe (needs prescription)"
        ],
        treatment: [
            "Keep area clean and dry",
            "Avoid scratching to prevent spreading",
            "Wear loose, breathable clothing",
            "Change clothes and bedding frequently",
            "Avoid sharing towels or personal items"
        ],
        duration: "2-4 weeks with treatment",
        doctor: "Dermatologist or General Physician",
        warning: "‚ö†Ô∏è Highly contagious - Avoid skin contact with others"
    },
    psoriasis: {
        name: "Psoriasis",
        confidence: 75,
        description: "Autoimmune condition causing red, scaly patches",
        medicines: [
            "Salicylic Acid shampoo/cream",
            "Topical corticosteroids - As prescribed",
            "Calcipotriol cream - Vitamin D analog"
        ],
        treatment: [
            "Avoid harsh soaps and hot water",
            "Use moisturizer regularly",
            "Limit stress and get good sleep",
            "Avoid smoking and alcohol",
            "Get sunlight exposure (vitamin D)"
        ],
        duration: "Chronic - Regular management",
        doctor: "Dermatologist",
        warning: "‚ö†Ô∏è Requires professional diagnosis and ongoing treatment"
    },
    urticaria: {
        name: "Urticaria/Hives",
        confidence: 80,
        description: "Allergic reaction causing itchy, raised welts on skin",
        medicines: [
            "Cetirizine 10mg - Once daily",
            "Loratadine 10mg - Once daily",
            "Calamine lotion - For symptomatic relief"
        ],
        treatment: [
            "Identify and avoid allergen triggers",
            "Use cool compresses on affected areas",
            "Avoid hot showers and tight clothing",
            "Keep skin moisturized",
            "Avoid scratching to prevent infection"
        ],
        duration: "Usually resolves in 24-48 hours",
        doctor: "General Physician or Dermatologist",
        warning: "‚ö†Ô∏è If with difficulty breathing, seek emergency care immediately"
    }
};

// Camera functionality
cameraBtn.addEventListener('click', async () => {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
        video.srcObject = stream;
        video.style.display = 'block';
        captureBtn.style.display = 'block';
        cameraBtn.textContent = '‚úì Camera Ready';
    } catch (err) {
        alert('üì∑ Camera not available. Please use "Upload Photo" instead.');
    }
});

// Capture image from camera
captureBtn.addEventListener('click', () => {
    const context = canvas.getContext('2d');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    context.drawImage(video, 0, 0);
    video.style.display = 'none';
    captureBtn.style.display = 'none';
    uploadedImageData = canvas.toDataURL();
    analyzeImage();
});

// File upload
fileUpload.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = () => {
            uploadedImageData = reader.result;
            analyzeImage();
        };
        reader.readAsDataURL(file);
    }
});

// AI Image Analysis with mock disease detection
function analyzeImage() {
    resultDiv.innerHTML = 'üîÑ Analyzing image with AI... Please wait...';
    
    setTimeout(() => {
        // Simulate AI analysis - in production, this would use a real ML model
        const diseases = ['acne', 'eczema', 'fungal', 'psoriasis', 'urticaria'];
        const detectedDisease = diseases[Math.floor(Math.random() * diseases.length)];
        const diseaseInfo = diseaseDatabase[detectedDisease];
        
        // Display result
        resultDiv.innerHTML = `
            <div style="text-align:center; width:100%;">
                <h3 style="color:#1b5e20; margin-bottom:1rem;">‚úÖ Analysis Complete</h3>
                <img src="${uploadedImageData}" style="max-width:250px; border-radius:10px; margin:1rem 0; box-shadow: 0 5px 15px rgba(0,0,0,0.2);">
            </div>
        `;
        
        // Show AI Response Section
        aiResponseSection.style.display = 'block';
        aiResponseDiv.innerHTML = `
            <h4>ü©∫ Detected Condition: ${diseaseInfo.name}</h4>
            <p><strong>Confidence Level:</strong> ${diseaseInfo.confidence}%</p>
            <p><strong>Description:</strong> ${diseaseInfo.description}</p>
            
            <h4>üíä Recommended Medicines:</h4>
            <ul>
                ${diseaseInfo.medicines.map(med => `<li>${med}</li>`).join('')}
            </ul>
            
            <h4>üè• Treatment & Care:</h4>
            <ul>
                ${diseaseInfo.treatment.map(treat => `<li>${treat}</li>`).join('')}
            </ul>
            
            <h4>‚è±Ô∏è Expected Duration:</h4>
            <p>${diseaseInfo.duration}</p>
            
            <h4>üë®‚Äç‚öïÔ∏è Recommended Doctor:</h4>
            <p>Consult a <strong>${diseaseInfo.doctor}</strong></p>
            
            <h4 style="color:#d32f2f;">${diseaseInfo.warning}</h4>
            
            <p style="margin-top:1rem; padding:1rem; background:#fff3e0; border-radius:8px;">
                <strong>üìù Important:</strong> This is AI-generated analysis only. Always consult with a qualified doctor for proper diagnosis and treatment. This tool is for informational purposes.
            </p>
        `;
        
        // Store disease info for chatbot
        window.currentDiseaseInfo = diseaseInfo;
    }, 2000);
}

// Enhance chatbot to discuss uploaded disease photo
const originalHandleIssue = handleIssue;
window.handleIssue = function(issue) {
    if (window.currentDiseaseInfo && issue === 'skin') {
        botMsg(`I see you've uploaded a photo. The AI detected: <strong>${window.currentDiseaseInfo.name}</strong>`);
        botMsg(`Confidence: ${window.currentDiseaseInfo.confidence}%`);
        botMsg(`Recommended doctor: ${window.currentDiseaseInfo.doctor}`);
        botMsg('Would you like to know more about treatment options?');
    } else {
        originalHandleIssue(issue);
    }
};

// ================ VIDEO CALL FUNCTIONALITY ================
function openDoctorSelection() {
    const doctorModal = document.getElementById('doctorModal');
    doctorModal.style.display = 'block';
}

function closeDoctorModal() {
    const doctorModal = document.getElementById('doctorModal');
    doctorModal.style.display = 'none';
}

let callTimer = 0;
let timerInterval = null;
let micEnabled = true;
let cameraEnabled = true;
let callType = 'video'; // 'video' or 'audio'

function initiateCall(doctorName, type) {
    callType = type;
    startCall(doctorName, type);
}

function startCall(doctorName, type) {
    const videoCallModal = document.getElementById('videoCallModal');
    const doctorNameDisplay = document.getElementById('doctorNameDisplay');
    const doctorVideoName = document.getElementById('doctorVideoName');
    
    doctorNameDisplay.textContent = doctorName;
    doctorVideoName.textContent = doctorName;
    
    // Show/hide video elements based on call type
    const patientVideo = document.querySelector('.patient-video');
    const doctorVideo = document.querySelector('.doctor-video');
    const videoStreams = document.querySelector('.video-streams');
    
    if (type === 'audio') {
        videoStreams.style.display = 'none';
        document.getElementById('toggleCamera').style.display = 'none';
    } else {
        videoStreams.style.display = 'grid';
        document.getElementById('toggleCamera').style.display = 'inline-block';
    }
    
    videoCallModal.style.display = 'block';
    
    // Reset chat
    const chatBox = document.getElementById('videoCallChat');
    chatBox.innerHTML = '';
    
    // Initial greeting from doctor
    setTimeout(() => {
        const msg = document.createElement('div');
        msg.className = 'msg doctor';
        msg.innerHTML = `<strong>${doctorName}:</strong> Hello! I'm ready to help you. Please tell me about your health concern.`;
        chatBox.appendChild(msg);
        chatBox.scrollTop = chatBox.scrollHeight;
    }, 800);
    
    // Start call timer
    callTimer = 0;
    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        callTimer++;
        const mins = Math.floor(callTimer / 60).toString().padStart(2, '0');
        const secs = (callTimer % 60).toString().padStart(2, '0');
        document.getElementById('callTimer').textContent = `${mins}:${secs}`;
    }, 1000);
    
    // Store current doctor info
    window.currentDoctor = {
        name: doctorName,
        type: type
    };
}

function endVideoCall() {
    clearInterval(timerInterval);
    const videoCallModal = document.getElementById('videoCallModal');
    videoCallModal.style.display = 'none';
    
    const callTypeText = callType === 'video' ? 'Video Call' : 'Audio Call';
    alert(`Thank you for consulting with ${window.currentDoctor.name}!\n\n${callTypeText} Duration: ${document.getElementById('callTimer').textContent}\n\nYour prescription and health records have been sent to your email.`);
}

function toggleMic() {
    micEnabled = !micEnabled;
    const btn = document.getElementById('toggleMic');
    if (micEnabled) {
        btn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        btn.innerHTML = '<i class="fas fa-microphone"></i>';
    } else {
        btn.style.background = '#f5576c';
        btn.innerHTML = '<i class="fas fa-microphone-slash"></i>';
    }
}

function toggleCamera() {
    cameraEnabled = !cameraEnabled;
    const btn = document.getElementById('toggleCamera');
    if (cameraEnabled) {
        btn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
        btn.innerHTML = '<i class="fas fa-video"></i>';
    } else {
        btn.style.background = '#f5576c';
        btn.innerHTML = '<i class="fas fa-video-slash"></i>';
    }
}

function shareScreen() {
    alert('Screen sharing activated! üì±\n\nShowing your device screen to the doctor.');
}

function sendVideoCallMessage() {
    const input = document.getElementById('videoChatInput');
    const chatBox = document.getElementById('videoCallChat');
    
    if (!input.value.trim()) return;
    
    // User message
    const userMsg = document.createElement('div');
    userMsg.className = 'msg user';
    userMsg.innerHTML = `<strong>You:</strong> ${input.value}`;
    chatBox.appendChild(userMsg);
    
    input.value = '';
    chatBox.scrollTop = chatBox.scrollHeight;
    
    // Doctor response (simulated)
    setTimeout(() => {
        const responses = [
            'I understand. Let me examine this further.',
            'Based on what you\'re describing, I recommend...',
            'This is a common condition. Here\'s what I suggest:',
            'Have you experienced any other symptoms?',
            'I\'ll prescribe the appropriate medication for you.',
            'Please follow these instructions and monitor your progress.',
            'If symptoms persist, please visit a clinic for tests.',
            'That\'s good to hear. Continue with the treatment.',
            'Let me send you a prescription. You\'ll receive it shortly.',
            'Please take this medicine and rest for a few days.'
        ];
        
        const doctorMsg = document.createElement('div');
        doctorMsg.className = 'msg doctor';
        doctorMsg.innerHTML = `<strong>${window.currentDoctor.name}:</strong> ${responses[Math.floor(Math.random() * responses.length)]}`;
        chatBox.appendChild(doctorMsg);
        chatBox.scrollTop = chatBox.scrollHeight;
    }, 1000);
}

// Close modals when clicking outside
window.onclick = function(e) {
    const videoCallModal = document.getElementById('videoCallModal');
    
    if (e.target === videoCallModal) {
        videoCallModal.style.display = 'none';
    }
};
</script>

</body>
</html>
